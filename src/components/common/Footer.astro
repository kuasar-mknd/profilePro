---
import config from "../../config.mjs";
import SocialIcon from "../ui/SocialIcon.astro";
---

<footer
  class="relative bg-white/80 dark:bg-pacamara-dark/80 backdrop-blur-md border-t border-pacamara-secondary/20 font-outfit"
>
  <div
    class="container mx-auto max-w-7xl px-7 py-12 grid grid-cols-1 lg:grid-cols-3 gap-12 lg:gap-8 items-start"
  >
    <!-- Column 1: Identity & Mission -->
    <div
      class="flex flex-col items-center lg:items-start text-center lg:text-left space-y-4"
    >
      <a
        href="/"
        aria-current={Astro.url.pathname === "/" ? "page" : undefined}
        class="font-bold font-pacamara-space text-2xl text-pacamara-primary dark:text-white hover:text-pacamara-accent transition-colors duration-300"
      >
        Samuel Dulex
      </a>
      <p
        class="text-pacamara-primary/80 dark:text-white/80 text-sm max-w-sm leading-relaxed"
      >
        Connecter, Communiquer, Captiver. <br />
        Cr√©ateur de contenu visuel et digital.
      </p>
      <div class="flex items-center gap-2 text-sm text-pacamara-accent">
        <span class="text-lg">üìç</span>
        <span class="font-medium">Lausanne, Suisse romande</span>
      </div>
    </div>

    <!-- Column 2: Socials & Copyright (Centered) -->
    <div class="flex flex-col items-center justify-center space-y-6">
      <ul class="flex flex-wrap justify-center gap-4">
        <SocialIcon
          socialUrl={config?.social?.dribbble}
          socialType="dribbble"
        />
        <SocialIcon
          socialUrl={config?.social?.facebook}
          socialType="facebook"
        />
        <SocialIcon socialUrl={config?.social?.github} socialType="github" />
        <SocialIcon
          socialUrl={config?.social?.instagram}
          socialType="instagram"
        />
        <SocialIcon
          socialUrl={config?.social?.mastodon}
          socialType="mastodon"
        />
        <SocialIcon
          socialUrl={config?.social?.pinterest}
          socialType="pinterest"
        />
        <SocialIcon socialUrl={config?.social?.skype} socialType="skype" />
        <SocialIcon socialUrl={config?.social?.twitter} socialType="twitter" />
        <SocialIcon socialUrl={config?.social?.youtube} socialType="youtube" />
      </ul>
      <div
        class="text-sm text-pacamara-primary/80 dark:text-white/80 text-center"
      >
        &copy; {new Date().getFullYear()} Samuel Dulex. <br
          class="visible sm:hidden"
        /> Tous droits r√©serv√©s.
      </div>
    </div>

    <!-- Column 3: Badge & Credits (Right Aligned) -->
    <div
      class="flex flex-col items-center lg:items-end text-center lg:text-right space-y-4"
    >
      <!-- Website Carbon Badge -->
      <div id="wcb" class="carbonbadge wcb-d" aria-label="Website Carbon Badge">
        <!-- Badge injected by script -->
      </div>

      <span class="text-sm text-pacamara-primary/80 dark:text-white/80">
        Fait avec <span
          class="text-red-500 animate-pulse motion-reduce:animate-none inline-block align-middle"
          >&#9829;</span
        > avec <a
          href="https://astro.build"
          target="_blank"
          rel="noopener noreferrer"
          class="font-medium hover:text-pacamara-accent transition-colors"
          >Astro</a
        >
      </span>
    </div>
  </div>

  <script is:inline>
    /**
     * ‚ö° Bolt: Carbon Badge View Transitions Support
     * Ensures the badge script is correctly re-injected and initialized on every page navigation.
     */
    function initCarbonBadge() {
      const isProduction =
        window.location.hostname !== "localhost" &&
        window.location.hostname !== "127.0.0.1";

      const wcb = document.getElementById("wcb");

      if (!isProduction) {
        if (wcb) {
          wcb.innerHTML =
            '<div class="text-xs text-gray-400 border border-gray-200 px-2 py-1 rounded">Carbon Badge (Dev)</div>';
        }
        return;
      }

      // Remove existing script if any (to force re-execution)
      const existingScript = document.getElementById("wcb-script");
      if (existingScript) {
        existingScript.remove();
      }

      // Inject new script
      const script = document.createElement("script");
      script.id = "wcb-script";
      script.src = "https://unpkg.com/website-carbon-badges@1.1.3/b.min.js"; // Use reliable CDN source
      script.defer = true;
      script.onerror = function () {
        if (wcb) wcb.style.display = "none";
        console.warn("Carbon Badge script failed to load");
      };
      document.body.appendChild(script);
    }

    // Initialize on initial load and every view transition
    document.addEventListener("astro:page-load", initCarbonBadge);
  </script>
  <style is:global>
    /* Fix Carbon Badge Contrast */
    #wcb #wcb_2 {
      color: var(--color-pacamara-primary) !important;
    }
    .dark #wcb #wcb_2 {
      color: rgba(255, 255, 255, 0.8) !important;
    }
  </style>
</footer>
