---
import { Icon } from "astro-icon/components";
---

<form
  action="https://api.web3forms.com/submit"
  method="POST"
  class="w-full max-w-lg mx-auto bg-white dark:bg-pacamara-dark/50 backdrop-blur-md p-8 rounded-3xl border border-pacamara-secondary/10 shadow-xl"
  id="contact-form"
>
  <!-- Access Key -->
  <input
    type="hidden"
    name="access_key"
    value={import.meta.env.PUBLIC_WEB3FORMS_ACCESS_KEY}
  />

  <!-- Optional: Subject -->
  <input type="hidden" name="subject" value="Nouveau message du Portfolio" />

  <!-- Optional: Honeypot -->
  <input
    type="checkbox"
    name="botcheck"
    class="hidden"
    style="display: none;"
  />

  <div class="mb-6">
    <label
      for="name"
      class="block mb-2 text-sm font-medium text-pacamara-primary dark:text-white"
      >Nom complet</label
    >
    <input
      type="text"
      name="name"
      id="name"
      required
      class="w-full px-4 py-3 rounded-xl bg-pacamara-white dark:bg-pacamara-dark border border-pacamara-secondary/20 focus:border-pacamara-accent focus:ring-2 focus:ring-pacamara-accent/20 outline-none transition-all duration-300 dark:text-white"
      placeholder="Votre nom"
    />
  </div>

  <div class="mb-6">
    <label
      for="email"
      class="block mb-2 text-sm font-medium text-pacamara-primary dark:text-white"
      >Email</label
    >
    <input
      type="email"
      name="email"
      id="email"
      required
      class="w-full px-4 py-3 rounded-xl bg-pacamara-white dark:bg-pacamara-dark border border-pacamara-secondary/20 focus:border-pacamara-accent focus:ring-2 focus:ring-pacamara-accent/20 outline-none transition-all duration-300 dark:text-white"
      placeholder="votre@email.com"
    />
  </div>

  <div class="mb-6">
    <label
      for="message"
      class="block mb-2 text-sm font-medium text-pacamara-primary dark:text-white"
      >Message</label
    >
    <textarea
      name="message"
      id="message"
      rows="4"
      required
      class="w-full px-4 py-3 rounded-xl bg-pacamara-white dark:bg-pacamara-dark border border-pacamara-secondary/20 focus:border-pacamara-accent focus:ring-2 focus:ring-pacamara-accent/20 outline-none transition-all duration-300 dark:text-white resize-none"
      placeholder="Parlez-moi de votre projet..."></textarea>
  </div>

  <button
    type="submit"
    class="w-full py-4 px-6 bg-pacamara-accent hover:bg-pacamara-secondary text-white font-bold rounded-xl transition-all duration-300 shadow-lg hover:shadow-glow hover-lift flex items-center justify-center gap-2"
  >
    <span>Envoyer le message</span>
    <Icon name="mdi:send" class="w-5 h-5" />
  </button>

  <p
    class="text-xs text-center mt-4 text-pacamara-primary/60 dark:text-white/60"
  >
    Powered by Web3Forms
  </p>
</form>

<script>
  const form = document.getElementById("contact-form") as HTMLFormElement;

  if (form) {
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData(form);
      const object = Object.fromEntries(formData);
      const json = JSON.stringify(object);
      const submitButton = form.querySelector("button[type='submit']");
      const originalButtonContent = submitButton
        ? submitButton.innerHTML
        : "Envoyer";

      if (submitButton) {
        submitButton.innerHTML = "Envoi en cours...";
        submitButton.setAttribute("disabled", "true");
      }

      try {
        const response = await fetch("https://api.web3forms.com/submit", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Accept: "application/json",
          },
          body: json,
        });

        const result = await response.json();

        if (result.success) {
          if (submitButton) submitButton.innerHTML = "Message envoyé !";
          form.reset();
          setTimeout(() => {
            if (submitButton) {
              submitButton.innerHTML = originalButtonContent;
              submitButton.removeAttribute("disabled");
            }
          }, 3000);
        } else {
          console.error(result);
          if (submitButton) {
            submitButton.innerHTML = "Erreur, réessayez.";
            setTimeout(() => {
              submitButton.innerHTML = originalButtonContent;
              submitButton.removeAttribute("disabled");
            }, 3000);
          }
        }
      } catch (error) {
        console.error(error);
        if (submitButton) {
          submitButton.innerHTML = "Erreur, réessayez.";
          setTimeout(() => {
            submitButton.innerHTML = originalButtonContent;
            submitButton.removeAttribute("disabled");
          }, 3000);
        }
      }
    });
  }
</script>
