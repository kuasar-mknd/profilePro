---
/**
 * Custom cursor component that adds a stylish dot follower cursor effect.
 * Only visible on devices with hover capability (not touch devices).
 */
---

<!-- Custom Cursor -->
<div class="custom-cursor hidden lg:block" id="custom-cursor">
  <div class="cursor-dot"></div>
  <div class="cursor-outline"></div>
</div>

<style>
  .custom-cursor {
    pointer-events: none;
    position: fixed;
    z-index: 9999;
  }

  .cursor-dot {
    position: fixed;
    width: 8px;
    height: 8px;
    background: var(--color-pacamara-accent);
    border-radius: 50%;
    pointer-events: none;
    transform: translate(-50%, -50%);
    transition:
      transform 0.1s ease,
      opacity 0.2s ease;
    z-index: 10001;
    mix-blend-mode: difference;
  }

  .cursor-outline {
    position: fixed;
    width: 40px;
    height: 40px;
    border: 2px solid var(--color-pacamara-accent);
    border-radius: 50%;
    pointer-events: none;
    transform: translate(-50%, -50%);
    transition:
      transform 0.15s ease-out,
      width 0.2s ease,
      height 0.2s ease,
      opacity 0.2s ease;
    z-index: 10000;
    opacity: 0.5;
  }

  /* Hover states */
  .cursor-hover .cursor-dot {
    transform: translate(-50%, -50%) scale(2);
    background: var(--color-pacamara-secondary);
  }

  .cursor-hover .cursor-outline {
    width: 60px;
    height: 60px;
    border-color: var(--color-pacamara-secondary);
    opacity: 0.3;
  }

  /* Click state */
  .cursor-click .cursor-dot {
    transform: translate(-50%, -50%) scale(0.5);
  }

  .cursor-click .cursor-outline {
    width: 30px;
    height: 30px;
  }

  /* Hide on text selection */
  .cursor-hidden .cursor-dot,
  .cursor-hidden .cursor-outline {
    opacity: 0;
  }

  /* Hide default cursor when custom cursor is active */
  @media (hover: hover) and (pointer: fine) {
    :global(body.custom-cursor-active) {
      cursor: none !important;
    }

    :global(body.custom-cursor-active a),
    :global(body.custom-cursor-active button),
    :global(body.custom-cursor-active [role="button"]),
    :global(body.custom-cursor-active input),
    :global(body.custom-cursor-active textarea),
    :global(body.custom-cursor-active select) {
      cursor: none !important;
    }
  }

  /* Disable on touch devices */
  @media (hover: none) {
    .custom-cursor {
      display: none !important;
    }
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .cursor-dot,
    .cursor-outline {
      transition: none;
    }
  }
</style>

<script>
  function initCustomCursor() {
    // Only init on devices with fine pointer (mouse)
    if (!window.matchMedia("(hover: hover) and (pointer: fine)").matches) {
      return;
    }

    const cursor = document.getElementById("custom-cursor");
    const dot = cursor?.querySelector(".cursor-dot") as HTMLElement;
    const outline = cursor?.querySelector(".cursor-outline") as HTMLElement;

    if (!cursor || !dot || !outline) return;

    // Show cursor and add class
    cursor.style.display = "block";
    document.body.classList.add("custom-cursor-active");

    let mouseX = 0;
    let mouseY = 0;
    let outlineX = 0;
    let outlineY = 0;

    // Track mouse position
    document.addEventListener("mousemove", (e) => {
      mouseX = e.clientX;
      mouseY = e.clientY;

      // Instant update for dot
      dot.style.left = `${mouseX}px`;
      dot.style.top = `${mouseY}px`;
    });

    // Smooth follow for outline
    function animateOutline() {
      outlineX += (mouseX - outlineX) * 0.15;
      outlineY += (mouseY - outlineY) * 0.15;

      outline.style.left = `${outlineX}px`;
      outline.style.top = `${outlineY}px`;

      requestAnimationFrame(animateOutline);
    }
    animateOutline();

    // Hover effect on interactive elements
    const interactiveElements =
      'a, button, [role="button"], input, textarea, select, .magnetic-btn, .tilt-card, .image-zoom';

    document.querySelectorAll(interactiveElements).forEach((el) => {
      el.addEventListener("mouseenter", () =>
        cursor.classList.add("cursor-hover"),
      );
      el.addEventListener("mouseleave", () =>
        cursor.classList.remove("cursor-hover"),
      );
    });

    // Click effect
    document.addEventListener("mousedown", () =>
      cursor.classList.add("cursor-click"),
    );
    document.addEventListener("mouseup", () =>
      cursor.classList.remove("cursor-click"),
    );

    // Hide when leaving window
    document.addEventListener("mouseleave", () =>
      cursor.classList.add("cursor-hidden"),
    );
    document.addEventListener("mouseenter", () =>
      cursor.classList.remove("cursor-hidden"),
    );
  }

  // Initialize
  initCustomCursor();
  document.addEventListener("astro:page-load", initCustomCursor);
</script>
