---
// ⚡ Bolt: Removed internal data fetching and computation.
// Tag counts are now pre-calculated once in getStaticPaths and passed as props
// to prevent O(P*N) redundant calculations during SSG (P = pages, N = projects).
interface Props {
  tags: string[];
  activeTag?: string;
  tagCounts: Record<string, number>;
  totalCount: number;
}

const { tags, activeTag, tagCounts, totalCount } = Astro.props;

// Helper for pluralization
const getProjetsLabel = (count: number) => (count > 1 ? "projets" : "projet");
---

<nav
  aria-label="Filtres de projets"
  class="flex flex-wrap justify-center gap-4 my-8"
  style="contain: layout;"
>
  <a
    href="/project"
    class={`px-4 py-2 rounded-full transition-all duration-300 border border-pacamara-secondary/30 backdrop-blur-md focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-pacamara-accent focus-visible:ring-offset-2
        ${!activeTag ? "bg-pacamara-accent text-white shadow-lg" : "bg-white/10 hover:bg-pacamara-accent/20 text-pacamara-primary dark:text-white"}`}
    aria-current={!activeTag ? "page" : undefined}
    aria-label={!activeTag
      ? `Filtre actif : Tous les projets (${totalCount} ${getProjetsLabel(totalCount)})`
      : `Afficher tous les projets (${totalCount} ${getProjetsLabel(totalCount)})`}
    title={!activeTag
      ? `Filtre actif : Tous les projets (${totalCount} ${getProjetsLabel(totalCount)})`
      : `Afficher tous les projets (${totalCount} ${getProjetsLabel(totalCount)})`}
  >
    Tous <span class="ml-1 text-xs opacity-70">({totalCount})</span>
  </a>
  {
    tags.map((tag: string) => {
      const count = tagCounts[tag] || 0;
      return (
        <a
          href={`/project/tag/${encodeURIComponent(tag)}`}
          class={`px-4 py-2 rounded-full transition-all duration-300 border border-pacamara-secondary/30 backdrop-blur-md capitalize focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-pacamara-accent focus-visible:ring-offset-2
            ${activeTag === tag ? "bg-pacamara-accent text-white shadow-lg" : "bg-white/10 hover:bg-pacamara-accent/20 text-pacamara-primary dark:text-white"}`}
          aria-current={activeTag === tag ? "page" : undefined}
          aria-label={
            activeTag === tag
              ? `Filtre actif : ${tag} (${count} ${getProjetsLabel(count)})`
              : `Filtrer par catégorie : ${tag} (${count} ${getProjetsLabel(count)})`
          }
          title={
            activeTag === tag
              ? `Filtre actif : ${tag} (${count} ${getProjetsLabel(count)})`
              : `Filtrer par catégorie : ${tag} (${count} ${getProjetsLabel(count)})`
          }
        >
          {tag} <span class="ml-1 text-xs opacity-70">({count})</span>
        </a>
      );
    })
  }
</nav>
