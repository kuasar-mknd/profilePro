---
import { ClientRouter } from 'astro:transitions';
import SeoHead from "../components/common/SeoHead.astro"
import Header from "../components/common/Header.astro"
import Footer from "../components/common/Footer.astro"
import '../css/style.css';

const { postData, jsonLd } = Astro.props;
---
<!doctype html>
<html lang="fr" class="scroll-smooth">
<head>
    <script is:inline>
        const setDarkMode = () => {
            if (localStorage.darkMode === 'true' || (!('darkMode' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark')
                localStorage.darkMode = 'true';
            } else {
                document.documentElement.classList.remove('dark')
                localStorage.darkMode = 'false';
            }
        }

        setDarkMode();
        document.addEventListener('astro:after-swap', setDarkMode);

        // Scroll Animations
        const observerOptions = {
            root: null,
            rootMargin: '0px',
            threshold: 0.1
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.remove('opacity-0', 'translate-y-10');
                    observer.unobserve(entry.target);
                }
            });
        }, observerOptions);

        const setupAnimations = () => {
            const elements = document.querySelectorAll('.animate-fade-in, .animate-slide-up');
            elements.forEach(el => {
                el.classList.add('opacity-0');
                if (el.classList.contains('animate-slide-up')) {
                    el.classList.add('translate-y-10');
                }
                observer.observe(el);
            });
        };

        document.addEventListener('DOMContentLoaded', setupAnimations);
        document.addEventListener('astro:after-swap', setupAnimations);
    </script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="alternate" type="application/rss+xml" title="RSS Feed" href="./rss.xml" />
    <SeoHead postData={postData} jsonLd={jsonLd} />
    
    <!-- Google Fonts: Outfit & Space Grotesk -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <link rel="sitemap" href="/sitemap-index.xml" />
    <ClientRouter />
</head>

<body class="font-outfit transition-colors duration-300 bg-pacamara-white dark:bg-pacamara-dark text-pacamara-primary dark:text-white overflow-x-hidden">
    <!-- Background Mesh Gradient -->
    <div class="fixed inset-0 z-[-1] opacity-30 dark:opacity-20 pointer-events-none overflow-hidden">
        <div class="absolute top-[-10%] left-[-10%] w-[50%] h-[50%] rounded-full bg-pacamara-secondary blur-[120px] animate-blob mix-blend-multiply dark:mix-blend-normal"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] rounded-full bg-pacamara-accent blur-[120px] animate-blob animation-delay-2000 mix-blend-multiply dark:mix-blend-normal"></div>
        <div class="absolute top-[40%] left-[40%] w-[50%] h-[50%] rounded-full bg-purple-500 blur-[120px] animate-blob animation-delay-4000 mix-blend-multiply dark:mix-blend-normal"></div>
    </div>

    <Header />
    
    <main class="min-h-screen pt-24 px-5 md:px-0">
        <slot />
    </main>

    <Footer />
</body>
</html>