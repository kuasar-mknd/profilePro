---
import { getCollection } from "astro:content";
import Base from "../layouts/Base.astro";
import Hero from "../components/features/home/Hero.astro";
import ServicesPreview from "../components/features/home/ServicesPreview.astro";
import LatestPosts from "../components/features/projects/LatestPosts.astro";
import CTASection from "../components/common/CTASection.astro";
import config from "../config.mjs";

const allProjects = await getCollection("project");

// ⚡ Bolt: Optimize Hero data payload
// Shuffle and slice here to avoid passing the entire collection to the component
function shuffle(array: any[]) {
  const newArray = [...array];
  for (let i = newArray.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
  }
  return newArray;
}

const heroProjects = shuffle(allProjects).slice(0, 15);

const jsonLd = {
  "@context": "https://schema.org",
  "@type": "Person",
  name: config.title,
  url: config.url,
  sameAs: [
    config.social.instagram,
    config.social.github,
    config.social.youtube,
  ].filter(Boolean),
  jobTitle: "Créateur de contenu & Développeur Web",
  worksFor: {
    "@type": "Organization",
    name: "Indépendant",
  },
  address: {
    "@type": "PostalAddress",
    addressLocality: "Lausanne",
    addressRegion: "Vaud",
    addressCountry: "CH",
  },
};
---

<Base jsonLd={jsonLd}>
  <main>
    <Hero projects={heroProjects} />
    <ServicesPreview />
    <LatestPosts postLimit={7} allPosts={allProjects} />
    <CTASection />
  </main>
</Base>
