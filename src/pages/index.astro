---
import Base from "../layouts/Base.astro";
import Hero from "../components/features/home/Hero.astro";
import ServicesPreview from "../components/features/home/ServicesPreview.astro";
import LatestPosts from "../components/features/projects/LatestPosts.astro";
import CTASection from "../components/common/CTASection.astro";
import config from "../config.mjs";
import { getCollection } from "astro:content";

// ⚡ Bolt: Fetch projects once at page level to prevent double-fetching in Hero and LatestPosts
const allPosts = await getCollection("project");

const jsonLd = {
  "@context": "https://schema.org",
  "@type": "Person",
  name: config.title,
  url: config.url,
  sameAs: [
    config.social.instagram,
    config.social.github,
    config.social.youtube,
  ].filter(Boolean),
  jobTitle: "Créateur de contenu & Développeur Web",
  worksFor: {
    "@type": "Organization",
    name: "Indépendant",
  },
  address: {
    "@type": "PostalAddress",
    addressLocality: "Lausanne",
    addressRegion: "Vaud",
    addressCountry: "CH",
  },
};
---

<Base jsonLd={jsonLd}>
  <main>
    <Hero allPosts={allPosts} />
    <ServicesPreview />
    <LatestPosts postLimit={7} allPosts={allPosts} />
    <CTASection />
  </main>
</Base>
