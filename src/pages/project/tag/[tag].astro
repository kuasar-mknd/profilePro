---
import { getCollection } from "astro:content";
import Base from "../../../layouts/Base.astro";
import Post from "../../../components/features/projects/Post.astro";
import ProjectFilter from "../../../components/features/projects/ProjectFilter.astro";
import ScrollReveal from "../../../components/ui/ScrollReveal.astro";

export async function getStaticPaths() {
  const allProjects = await getCollection("project");
  const uniqueTags = [
    ...new Set(allProjects.map((project) => project.data.tag).flat()),
  ];

  return uniqueTags.map((tag) => {
    const filteredProjects = allProjects
      .filter((project) =>
        Array.isArray(project.data.tag)
          ? project.data.tag.includes(tag)
          : project.data.tag === tag,
      )
      .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
    return {
      params: { tag },
      props: { projects: filteredProjects, allTags: uniqueTags },
    };
  });
}

const { tag } = Astro.params;
const { projects, allTags } = Astro.props;
---

<Base>
  <section class="container mx-auto max-w-7xl px-7 pt-10 pb-14">
    <ScrollReveal class="text-center mb-10">
      <h1
        class="text-3xl md:text-5xl font-pacamara-space font-bold mb-6 text-pacamara-dark dark:text-white relative inline-block"
      >
        <span class="capitalize">{tag}</span>
        <span class="text-shimmer">Projects</span>
      </h1>
      <ProjectFilter tags={allTags} activeTag={tag} />
    </ScrollReveal>

    <div class="flex flex-wrap justify-center gap-8 mb-16">
      {
        projects.map((post, index) => (
          <ScrollReveal
            delay={index * 0.1}
            class="w-full md:w-[calc(50%-1rem)]"
          >
            <Post postData={post} num={index} />
          </ScrollReveal>
        ))
      }
    </div>
  </section>
</Base>
