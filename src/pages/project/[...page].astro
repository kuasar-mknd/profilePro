---
import type { Page, PaginateFunction } from "astro";
import type { CollectionEntry } from "astro:content";
import { getCollection } from "astro:content";
import config from "../../config.mjs";

import Base from "../../layouts/Base.astro";
import Post from "../../components/features/projects/Post.astro";
import ProjectFilter from "../../components/features/projects/ProjectFilter.astro";
import ScrollReveal from "../../components/ui/ScrollReveal.astro";
import Breadcrumbs from "../../components/ui/Breadcrumbs.astro";
import EmptyState from "../../components/ui/EmptyState.astro";

export async function getStaticPaths({
  paginate,
}: {
  paginate: PaginateFunction;
}) {
  const allProjects = await getCollection("project");
  const uniqueTags = [
    ...new Set(allProjects.map((project) => project.data.tag).flat()),
  ];

  const projectEntries = allProjects.sort(
    (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
  );

  return paginate(projectEntries, {
    pageSize: config.postsPerPage,
    props: { allTags: uniqueTags },
  });
}

interface Props {
  page: Page<CollectionEntry<"project">>;
  allTags: string[];
}

const { page, allTags } = Astro.props;
---

<Base>
  <section class="container mx-auto max-w-7xl px-7 pt-10 pb-20">
    <ScrollReveal class="text-center mb-10">
      <Breadcrumbs
        items={[{ label: "Accueil", href: "/" }, { label: "Projets" }]}
      />
      <h1
        class="text-3xl md:text-5xl font-pacamara-space font-bold mb-6 text-pacamara-dark dark:text-white relative inline-block"
      >
        Toutes les <span class="text-shimmer">Réalisations</span>
      </h1>
      <p
        class="text-lg text-pacamara-primary/70 dark:text-white/70 font-outfit max-w-2xl mx-auto mb-8"
      >
        Une collection de mes projets récents en vidéo, photo et développement.
      </p>
      <ProjectFilter tags={allTags} />
    </ScrollReveal>
    <div class="flex flex-wrap justify-center gap-8 mb-16">
      {
        page.data.length === 0 ? (
          <EmptyState message="Aucun projet trouvé pour le moment." />
        ) : (
          page.data.map((post, index) => {
            return (
              <ScrollReveal
                delay={index * 0.1}
                class="w-full md:w-[calc(50%-1rem)]"
              >
                <Post postData={post} num={index} priority={index < 2} />
              </ScrollReveal>
            );
          })
        )
      }
    </div>
    <div class="flex flex-row justify-center gap-7">
      {
        page.url.prev ? (
          <a
            href={page.url.prev}
            class="text-base bg-transparent border border-pacamara-secondary leading-none rounded-full py-3 px-6 text-pacamara-secondary hover:bg-pacamara-accent hover:border-pacamara-accent hover:text-pacamara-white transition-all duration-300 font-pacamara-space font-bold hover-scale-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-pacamara-accent focus-visible:ring-offset-2"
            aria-label="Page précédente"
          >
            &larr; Précédent
          </a>
        ) : null
      }
      {
        page.url.next ? (
          <a
            href={page.url.next}
            class="text-base bg-transparent border border-pacamara-secondary leading-none rounded-full py-3 px-6 text-pacamara-secondary hover:bg-pacamara-accent hover:border-pacamara-accent hover:text-pacamara-white transition-all duration-300 font-pacamara-space font-bold hover-scale-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-pacamara-accent focus-visible:ring-offset-2"
            aria-label="Page suivante"
          >
            Suivant &rarr;
          </a>
        ) : null
      }
    </div>
  </section>
</Base>
